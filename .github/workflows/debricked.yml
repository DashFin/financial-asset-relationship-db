# This workflow uses Debricked (OpenText Core SCA) for vulnerability scanning
# Debricked documentation: https://docs.debricked.com/

name: Vulnerability Scan

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]
  workflow_dispatch:

permissions:
  contents: read
  security-events: write

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Debricked CLI
        run: |
          curl -L https://github.com/debricked/cli/releases/latest/download/cli_linux_x86_64.tar.gz | tar -xz
          sudo mv debricked /usr/local/bin/
          debricked --version

      - name: Run Debricked Scan
        env:
          # Secret is read from GitHub Actions secrets context
          DEBRICKED_TOKEN: ${{ secrets.DEBRICKED_TOKEN }}
        run: |
          debricked scan -t $DEBRICKED_TOKEN -r ${{ github.repository }} -c ${{ github.sha }}
